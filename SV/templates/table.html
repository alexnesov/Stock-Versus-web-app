{%extends "base.html"%}
{%block content%}

<head>
  <link href="/static/style_table.css" rel="stylesheet" type="text/css">
  <title>GTS-Table</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
  <meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0"/>

</head>

<body id="Table_page">



  <h3>Signals</h3>





<div class="chart" id="line" style=max-width:100%;overflow:hidden;border:none;padding:0;margin:0 auto;display:block;" marginheight="0" marginwidth="0">
  <script>
    var graphs = {{plot | safe}};
    Plotly.plot('line',graphs,{});
  </script> 
<hr>

</div>
  </p>

    <form class="form" autocomplete="off" spellcheck="false" method="POST">

      </div>
          <div class="row">
            <label for="date_input" class="col-form-label col-form-label-sm">Signals untill: </label>
            
            <div class="col-sm-2">
              {{ form.date_input(class="form-control form-control-sm", type="date", value=strToday | safe)}}
            </div>

            
              <div class="btn-toolbar">
                <input type="submit" class="btn btn-secondary btn-sm mr-2 mb-2" id="validate_date" value="Filter">
                <input type="submit" class="btn btn-secondary btn-sm mr-2 mb-2" id="reset" value="Reset">
                <a href="/getCSV" input class="btn btn-success btn-sm mr-2 mb-2" id="getcsv">Download</a>
            </div>
      </div>

    </form>
  <div>
    <p style="text-align:center">

      {%if average>0%}
      <img alt="dl icon" src="../static/green-arrow.png" width="30" height="30" >
    </br>

      Average overall return: <font color="green"><b>{{average}}</b></font> % 
      {%elif average==0%}
      Average overall return: 0 %
      {%else%}
      Average overall return: <font color="red"><b>{{average}}</b></font> %
      <img alt="dl icon" src="../static/red-arrow.png" width="30" height="30" >
      {% endif %}
    </br>

      {%if SP500evol>0%}
      <b>SP 500</b> evol. over the same period : 
      <font color="green"><b>{{SP500evol}}</b></font> % 
      {%else%}
      <b>SP 500</b> evol. over the same period : 
      <font color="red"><b>{{SP500evol}}</b></font> % 
      {% endif %}
    </br>

    (<strong>{{lastD}}</strong> to <strong>{{firstD}}</strong>)

    </p>

  </div>




</div>


<div class="table-wrapper-scroll-y my-custom-scrollbar" >

<table class="table table-bordered table-striped table-sm table-hover" style=max-width:100%;overflow:hidden;border:none;padding:0;margin:0 auto;display:block;" marginheight="0" marginwidth="0">
  <thead class="thead-dark">
    <th scope="col">ValidTick</th>
    <th scope="col">SignalDate</th>
    <th scope="col">ScanDate</th>
    <th scope="col">NScanDaysInterval</th>
    <th scope="col">PriceAtSignal</th>
    <th scope="col">Last closing price</th>
    <th scope="col">Price Evolution</th>
  </thead>
  {% for item in items %}
  <tr>
    <td>{{ item[0] }}</td>
    <td>{{ item[1] }}</td>
    <td>{{ item[2] }}</td>
    <td>{{ item[3] }}</td>
    <td>{{ item[4] }}</td>
    <td>{{ item[5] }}</td>
    <td>{{ item[6] }}</td>
  </tr>
  {% endfor %}
</table>
</div>
</br>
<hr>
</br>

<h3>Signals visualization</h3>

<p>
  You can enter one of the Symbols present in the table above to visualize the Signals.
  For now, only the stocks marked as signaled can be charted with the tool below.
</p>
<form class="form-inline" method="post" action="/changeSignalChart">
  <div class="form-group mx-sm-3 mb-2">
      {{ form.validChartSignal(class="form-control")}}
  </div>
  <button type="submit" class="btn btn-primary mb-2">Confirm</button>
</form>

<div class="SignalChart" id="SignalChart">
  <script>
    var graphs = {{SignalChart | safe}};
    Plotly.plot('SignalChart',graphs,{});
  </script>
</div>

<p>
<b>Assumption to test for the future:</b> Taking a longer <i>long_mvg</i> (50&ltmvg<=200) will reduce the number of false positives.

</p>
</code>

</body>
{% include "base_dashboard.html" %}

{%endblock%}

