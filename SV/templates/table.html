{%extends "base.html"%}
{%block content%}

<head>
  <link href="/static/style_table.css" rel="stylesheet" type="text/css">
  <title>GTS-Table</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
  <meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0"/>

</head>

<body id="Table_page">

<h3>Signals</h3>
<hr>
<p>
  <b>  <font color="#32CD32">To be implemented:</font></b>
</br>
<b>A signal, by essence, should be idiosyncratic.</b> Hence, bullish markets will create more false signals in the casse of bullish signals.
Therefore, the most convincing signals are those which are going to be contrarian relatively to the current market conditions (<i>i.e</i> bullish, bearish and sideways trends).

</p>

<div class="signalEvolsChart" id="signalEvolsChart" style=max-width:100%;overflow:hidden;border:none;padding:0;margin:0 auto;display:block;" marginheight="0" marginwidth="0">
  <script>
    var graphs = {{signalSectorEvolChart | safe}};
    Plotly.plot('signalEvolsChart',graphs,{});
  </script> 
</div>

<div class="chart" id="line" style=max-width:100%;overflow:hidden;border:none;padding:0;margin:0 auto;display:block;" marginheight="0" marginwidth="0">
  <script>
    var graphs = {{plot | safe}};
    Plotly.plot('line',graphs,{});
  </script> 
</div>






    <p style="text-align:center">


      {%if SP500evol>0%}
      <b>SP 500</b> evol. over the same period: 
      <font color="green"><b>{{SP500evol}}</b></font> % 
      {%else%}
      <b>SP 500</b> evol. over the same period: 
      <font color="red"><b>{{SP500evol}}</b></font> % 
      {% endif %}
    </br>

      <b>NASDAQ &lt 15$ </b> evol. over the same period: 

    </br>

    (<strong>{{spSTART}}</strong> to <strong>{{spEND}}</strong>)

    </p>

  <hr>
  </p>
    <form class="form" autocomplete="off" spellcheck="false" method="POST">

      </div>
          <div class="row">
<!--             <label for="date_input" class="col-form-label col-form-label-sm">Signals untill: </label>
            
            <div class="col-sm-2">
              {{ form.date_input(class="form-control form-control-sm", type="date", value=strToday | safe)}}
            </div> -->
            <div class="btn-toolbar">
<!--               <input type="submit" class="btn btn-secondary btn-sm mr-2 mb-2" id="validate_date" value="Filter">
              <input type="submit" class="btn btn-secondary btn-sm mr-2 mb-2" id="reset" value="Reset"> -->
                <a href="/getCSV" input class="btn btn-success btn-sm mr-2 mb-2" id="getcsv">Download</a>
            </div>
      </div>

    </form>

  </div>

</div>

<p>
<b>Number of signals:</b> {{nSignals}}
</br>

<code>
# When 'Aroon Up' crosses 'Aroon Down' from below </br>
df["signal"][short_window:] =np.where(df['short_mavg'][short_window:] > df['long_mavg'][short_window:], 1,0)</br>
df['positions'] = df['signal'].diff()
</code>

</br>
<code>
  df['doubleSignal'] = np.where(
    (df["Aroon Up"] > df["Aroon Down"]) & (df['positions']==1) & (df["Aroon Down"]<75) &(df["Aroon Up"]>55),
    1,0)
</code>
</br>
<p>


</p>
</p>
<div class="table-wrapper-scroll-y my-custom-scrollbar" >

<table class="table table-bordered table-striped table-sm table-hover" style=max-width:100%;overflow:hidden;border:none;padding:0;margin:0 auto;display:block;" marginheight="0" marginwidth="0">
  <thead class="thead-dark">
    {% for col in colNames %}
    <th scope="col">{{ col }}</th>
    {% endfor %}
  </thead>
    {% for item in items %}
  <tr>
    {% for w in widthDF %}
    <td>{{ item[w] }}</td>
  {% endfor %}

  </tr>
  {% endfor %}

</table>



</div>


</br>
</br>

<h3>Signals visualization</h3>
<hr>

<p>
  You can enter one of the Symbols present in the table above to visualize the Signals.
  For now, only the stocks marked as signaled can be charted with the tool below.
</p>
<form class="form-inline" method="post" action="/changeSignalChart">
  <div class="form-group mx-sm-3 mb-2">
      {{ form.validChartSignal(class="form-control")}}
  </div>
  <button type="submit" class="btn btn-primary mb-2">Confirm</button>
</form>

<div class="SignalChart" id="SignalChart">
  <script>
    var graphs = {{SignalChart | safe}};
    Plotly.plot('SignalChart',graphs,{});
  </script>
</div>

<p>
  <br>
  <br>

<b>Assumption to test in the future:</b> Taking a longer <i>long_mvg</i> (50&ltmvg<=200) will reduce the number of false positives.
<br>
<br>

</p>


</body>
{% include "base_dashboard.html" %}

{%endblock%}